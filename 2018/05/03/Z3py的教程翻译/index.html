<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="foyjog"><title>Z3py的教程翻译 · foyjog</title><meta name="description" content="写在前面Z3Py感觉在逆向方面还是挺好用的，最近把教程看了一下，然后做一下翻译。
致谢这是Leonardo de Moura的Z3Py教程的归档版本。Sorig进行了语法的校对。
python中的Z3 APIZ3是Microsoft Research开发的高性能定理证明器。Z3拥有者非常广泛的应用场"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><h3 title=""><a href="/">foyjog</a></h3><div class="description"><p>email:foyjog@163.com</p></div></div></div><ul class="social-links"></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a href="https://www.caicai.me"> CaiCai </a><span>&</span><a href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">主页</a></li><li><a href="/about">关于</a></li><li><a href="/archives">归档</a></li><li><a href="/links">链接</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>Z3py的教程翻译</a></h3></div><div class="post-content"><h1 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h1><p>Z3Py感觉在逆向方面还是挺好用的，最近把教程看了一下，然后做一下翻译。</p>
<h1 id="致谢"><a href="#致谢" class="headerlink" title="致谢"></a>致谢</h1><p>这是Leonardo de Moura的Z3Py教程的归档版本。Sorig进行了语法的校对。</p>
<h1 id="python中的Z3-API"><a href="#python中的Z3-API" class="headerlink" title="python中的Z3 API"></a>python中的Z3 API</h1><p>Z3是Microsoft Research开发的高性能定理证明器。Z3拥有者非常广泛的应用场景：软件/硬件验证和测试，约束求解，混合系统分析，安全性研究，生物学研究（计算机分析）以及几何问题。</p>
<p>本教程演示了Z3Py的主要功能：Python中的Z3 API。阅读本教程不需要任何的Python知识。但是你学一下python对本教程的学习还是很有用的。</p>
<p>Z3发行版还包含了c,.net和OCaml的API。Z3Py的源码可以在Z3的发行版中获取，这方便通过修改源码满足你自己的特殊需求。源代码还演示了如何在Z3 4.0中使用新功能。Z3的前端包括Scala^Z3和SBV。</p>
<p>在跟随这些示例的时候一定要自己亲自演示一下代码。Z3Py表示：跑跑自己的脚本，搞搞自己的实验。</p>
<h1 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h1><p>先看看如下简单的一个示例：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x = Int(<span class="string">'x'</span>)</span><br><span class="line">y = Int(<span class="string">'y'</span>)</span><br><span class="line">solve(x &gt; <span class="number">2</span>, y &lt; <span class="number">10</span>, x + <span class="number">2</span>*y == <span class="number">7</span>)</span><br></pre></td></tr></table></figure></p>
<p>Int(‘x’)功能是在Z3中创建了一个名为x的int变量。sovle函数用来解决该约束系统。上面的例子使用了两个变量x和y以及三个约束。在上面的例子中，表达式x+2*y==7是一个约束条件。Z3可以用来解决或者简化公式。</p>
<p>下面的例子展示了如何利用Z3公式/表达式简化器。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x = Int(<span class="string">'x'</span>)</span><br><span class="line">y = Int(<span class="string">'y'</span>)</span><br><span class="line"><span class="keyword">print</span> simplify(x + y + <span class="number">2</span>*x + <span class="number">3</span>)</span><br><span class="line"><span class="keyword">print</span> simplify(x &lt; y + x + <span class="number">2</span>)</span><br><span class="line"><span class="keyword">print</span> simplify(And(x + <span class="number">1</span> &gt;= <span class="number">3</span>, x**<span class="number">2</span> + x**<span class="number">2</span> + y**<span class="number">2</span> + <span class="number">2</span> &gt;= <span class="number">5</span>))</span><br></pre></td></tr></table></figure></p>
<p>默认情况下，Z3Py(网页模式)使用数学符号显示公式和表达式。通常来说，∧是逻辑和，∨是逻辑或，等等。（html_mode=False）命令使所有公式和表达式以Z3Py表示法显示。这也是Z3发行版中Z3Py离线版本的默认模式。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x = Int(<span class="string">'x'</span>)</span><br><span class="line">y = Int(<span class="string">'y'</span>)</span><br><span class="line"><span class="keyword">print</span> x**<span class="number">2</span> + y**<span class="number">2</span> &gt;= <span class="number">1</span></span><br><span class="line">set_option(html_mode=<span class="keyword">False</span>)</span><br><span class="line"><span class="keyword">print</span> x**<span class="number">2</span> + y**<span class="number">2</span> &gt;= <span class="number">1</span></span><br></pre></td></tr></table></figure></p>
<p>Z3提供了解析表达式的函数。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">x = Int(<span class="string">'x'</span>)</span><br><span class="line">y = Int(<span class="string">'y'</span>)</span><br><span class="line">n = x + y &gt;= <span class="number">3</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">"num args: "</span>, n.num_args()</span><br><span class="line"><span class="keyword">print</span> <span class="string">"children: "</span>, n.children()</span><br><span class="line"><span class="keyword">print</span> <span class="string">"1st child:"</span>, n.arg(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"2nd child:"</span>, n.arg(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"operator: "</span>, n.decl()</span><br><span class="line"><span class="keyword">print</span> <span class="string">"op name:  "</span>, n.decl().name()</span><br></pre></td></tr></table></figure></p>
<p>Z3提供了所有基本的数学运算。Z3Py和Python运算符优先级是相同的。像Python一样，**是次方运算符。 Z3可以求解非线性多项式的约束方程。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x = Real(<span class="string">'x'</span>)</span><br><span class="line">y = Real(<span class="string">'y'</span>)</span><br><span class="line">solve(x**<span class="number">2</span> + y**<span class="number">2</span> &gt; <span class="number">3</span>, x**<span class="number">3</span> + y &lt; <span class="number">5</span>)</span><br></pre></td></tr></table></figure></p>
<p>脚本利用Real(‘x’)来创建一个实数x。Z3Py可以表示任意大的整数，有理数和无理数。一个无理数是具有整数系数的多项式的根。Z3可以精确地表示这些数字。无理数以十进制表示法显示，以便我们读取结果。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">x = Real(<span class="string">'x'</span>)</span><br><span class="line">y = Real(<span class="string">'y'</span>)</span><br><span class="line">solve(x**<span class="number">2</span> + y**<span class="number">2</span> == <span class="number">3</span>, x**<span class="number">3</span> == <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">set_option(precision=<span class="number">30</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"Solving, and displaying result with 30 decimal places"</span></span><br><span class="line">solve(x**<span class="number">2</span> + y**<span class="number">2</span> == <span class="number">3</span>, x**<span class="number">3</span> == <span class="number">2</span>)</span><br></pre></td></tr></table></figure></p>
<p>set_option 函数用来配置Z3的环境，比如结果的显示方式。set_option(precision=30)将小数点精度设置为30。上述脚本的结果中?表示的是输出被截断了。</p>
<p>以下示例演示了一个常见的错误。表达式3/2是一个Python整数，而不是Z3有理数。该示例还展示了在Z3Py中创建有理数的不同方法。Q（num，den）创建了一个Z3有理数，其中num是分子，den是分母。RealVal（1）创建一个表示数字1的Z3实数。</p>
<p>有理数也可以用十进制表示法显示。</p>
<p>约束方程式有时候可能没有解。 在这种情况下，我们说这个方程不可解。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x = Real(<span class="string">'x'</span>)</span><br><span class="line">solve(x &gt; <span class="number">4</span>, x &lt; <span class="number">0</span>)</span><br></pre></td></tr></table></figure></p>
<p>像在Python中一样，注释以＃开头，在行尾结束。 Z3Py不支持跨越多行的注释。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This is a comment</span></span><br><span class="line">x = Real(<span class="string">'x'</span>) <span class="comment"># comment: creating x</span></span><br><span class="line"><span class="keyword">print</span> x**<span class="number">2</span> + <span class="number">2</span>*x + <span class="number">2</span>  <span class="comment"># comment: printing polynomial</span></span><br></pre></td></tr></table></figure></p>
<h1 id="布尔逻辑"><a href="#布尔逻辑" class="headerlink" title="布尔逻辑"></a>布尔逻辑</h1><p>Z3支持布尔运算符：And，Or，Not，Implies (逻辑蕴含)，If（if-then-else）。双蕴含使用==表示。以下示例展示如何解决一组简单的布尔约束。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">p = Bool(<span class="string">'p'</span>)</span><br><span class="line">q = Bool(<span class="string">'q'</span>)</span><br><span class="line">r = Bool(<span class="string">'r'</span>)</span><br><span class="line">solve(Implies(p, q), r == Not(q), Or(Not(p), r))</span><br></pre></td></tr></table></figure></p>
<p>Python布尔常量True和False可用于构建Z3布尔表达式。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">p = Bool(<span class="string">'p'</span>)</span><br><span class="line">q = Bool(<span class="string">'q'</span>)</span><br><span class="line"><span class="keyword">print</span> And(p, q, <span class="keyword">True</span>)</span><br><span class="line"><span class="keyword">print</span> simplify(And(p, q, <span class="keyword">True</span>))</span><br><span class="line"><span class="keyword">print</span> simplify(And(p, <span class="keyword">False</span>))</span><br></pre></td></tr></table></figure></p>
<p>以下示例使用多项式和布尔约束的组合。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">p = Bool(<span class="string">'p'</span>)</span><br><span class="line">x = Real(<span class="string">'x'</span>)</span><br><span class="line">solve(Or(x &lt; <span class="number">5</span>, x &gt; <span class="number">10</span>), Or(p, x**<span class="number">2</span> == <span class="number">2</span>), Not(p))</span><br></pre></td></tr></table></figure></p>
<h1 id="求解器"><a href="#求解器" class="headerlink" title="求解器"></a>求解器</h1><p>Z3提供了不同的求解器。在前面的示例中，solve函数的实现利用了Z3求解器的API。该实现可以在Z3发行版的z3.py文件中找到。以下示例演示了基本的Solver API。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">x = Int(<span class="string">'x'</span>)</span><br><span class="line">y = Int(<span class="string">'y'</span>)</span><br><span class="line"></span><br><span class="line">s = Solver()</span><br><span class="line"><span class="keyword">print</span> s</span><br><span class="line"></span><br><span class="line">s.add(x &gt; <span class="number">10</span>, y == x + <span class="number">2</span>)</span><br><span class="line"><span class="keyword">print</span> s</span><br><span class="line"><span class="keyword">print</span> <span class="string">"Solving constraints in the solver s ..."</span></span><br><span class="line"><span class="keyword">print</span> s.check()</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"Create a new scope..."</span></span><br><span class="line">s.push()</span><br><span class="line">s.add(y &lt; <span class="number">11</span>)</span><br><span class="line"><span class="keyword">print</span> s</span><br><span class="line"><span class="keyword">print</span> <span class="string">"Solving updated set of constraints..."</span></span><br><span class="line"><span class="keyword">print</span> s.check()</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"Restoring state..."</span></span><br><span class="line">s.pop()</span><br><span class="line"><span class="keyword">print</span> s</span><br><span class="line"><span class="keyword">print</span> <span class="string">"Solving restored set of constraints..."</span></span><br><span class="line"><span class="keyword">print</span> s.check()</span><br></pre></td></tr></table></figure></p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2018-05-03</span><i class="fa fa-tag"></i></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" href="http://twitter.com/home?status=,https://foyjog.github.io/2018/05/03/Z3py的教程翻译/,foyjog,Z3py的教程翻译,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="next pagbuttons"><a class="btn" role="navigation" href="/2018/04/20/ddctf2018-部分writeup/" title="ddctf2018-部分writeup">Próximo post</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>