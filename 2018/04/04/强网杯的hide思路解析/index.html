<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.3.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.3.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.3.0',
    sidebar: {"position":"right","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="概述这个题目其实，，，我最后没有得出确切的结论，因为比赛已经结束了，没有机会验证。这个题一看，很容易得出是个linux下的upx程序，脱壳对于我来说是不可能了，除了利用upx -d这种试了一下发现没啥鸟用，就没有再关心这个壳，其实压缩壳加密壳直接带壳跑也没啥。 思路流程题目好像不是很难的感觉，只是分析的时候多点儿时间就可以了，放如ida，然后运行，发现程序瞬间退出了，确定程序做了反调试的机制，利用">
<meta property="og:type" content="article">
<meta property="og:title" content="强网杯的hide思路解析">
<meta property="og:url" content="https://foyjog.github.io/2018/04/04/强网杯的hide思路解析/index.html">
<meta property="og:site_name" content="foyjog">
<meta property="og:description" content="概述这个题目其实，，，我最后没有得出确切的结论，因为比赛已经结束了，没有机会验证。这个题一看，很容易得出是个linux下的upx程序，脱壳对于我来说是不可能了，除了利用upx -d这种试了一下发现没啥鸟用，就没有再关心这个壳，其实压缩壳加密壳直接带壳跑也没啥。 思路流程题目好像不是很难的感觉，只是分析的时候多点儿时间就可以了，放如ida，然后运行，发现程序瞬间退出了，确定程序做了反调试的机制，利用">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-07-03T08:19:37.749Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="强网杯的hide思路解析">
<meta name="twitter:description" content="概述这个题目其实，，，我最后没有得出确切的结论，因为比赛已经结束了，没有机会验证。这个题一看，很容易得出是个linux下的upx程序，脱壳对于我来说是不可能了，除了利用upx -d这种试了一下发现没啥鸟用，就没有再关心这个壳，其实压缩壳加密壳直接带壳跑也没啥。 思路流程题目好像不是很难的感觉，只是分析的时候多点儿时间就可以了，放如ida，然后运行，发现程序瞬间退出了，确定程序做了反调试的机制，利用">



  <link rel="alternate" href="/atom.xml" title="foyjog" type="application/atom+xml" />




  <link rel="canonical" href="https://foyjog.github.io/2018/04/04/强网杯的hide思路解析/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>强网杯的hide思路解析 | foyjog</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">foyjog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">reversing engineer</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Home</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />Archives</a>
  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://foyjog.github.io/2018/04/04/强网杯的hide思路解析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="foyjog">
      <meta itemprop="description" content="email:foyjog@163.com">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="foyjog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">强网杯的hide思路解析
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-04-04 17:19:42" itemprop="dateCreated datePublished" datetime="2018-04-04T17:19:42+08:00">2018-04-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-07-03 16:19:37" itemprop="dateModified" datetime="2018-07-03T16:19:37+08:00">2018-07-03</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>这个题目其实，，，我最后没有得出确切的结论，因为比赛已经结束了，没有机会验证。<br>这个题一看，很容易得出是个linux下的upx程序，脱壳对于我来说是不可能了，除了利用upx -d这种试了一下发现没啥鸟用，就没有再关心这个壳，其实压缩壳加密壳直接带壳跑也没啥。</p>
<h3 id="思路流程"><a href="#思路流程" class="headerlink" title="思路流程"></a>思路流程</h3><p>题目好像不是很难的感觉，只是分析的时候多点儿时间就可以了，放如ida，然后运行，发现程序瞬间退出了，确定程序做了反调试的机制，利用strace做跟踪，如下：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">access(<span class="string">"/etc/ld.so.nohwcap"</span>, F_OK)      = <span class="number">-1</span> ENOENT (No such file <span class="keyword">or</span> directory)</span><br><span class="line">ptrace(PTRACE_TRACEME, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>)   = <span class="number">-1</span> EPERM (Operation <span class="keyword">not</span> permitted)</span><br><span class="line">ptrace(PTRACE_TRACEME, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>)   = <span class="number">-1</span> EPERM (Operation <span class="keyword">not</span> permitted)</span><br><span class="line">exit_group(<span class="number">0</span>)                           = ?</span><br><span class="line">+++ exited with <span class="number">0</span> +++</span><br><span class="line">foyjog@ubuntu:~/Desktop/ctf/<span class="number">00</span>ctf$</span><br></pre></td></tr></table></figure></p>
<p>初步猜测是用的ptrace自身来达到反调试的效果，一开始我通过硬件断点到hide段<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hide	00000000006CC000	00000000006CD000	R	W	X	D	.	byte	0000	public	CODE	64	0000	0000	0000	0000	0000</span><br></pre></td></tr></table></figure></p>
<p>的方法查到了函数判断点如下：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">__<span class="function">int64 <span class="title">sub_4009EF</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *v0; <span class="comment">// rsi</span></span><br><span class="line">  __int64 v1; <span class="comment">// rdx</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  __int64 v3; <span class="comment">// rcx</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v4; <span class="comment">// rt1</span></span><br><span class="line">  <span class="keyword">char</span> v5; <span class="comment">// [rsp+10h] [rbp-70h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v6; <span class="comment">// [rsp+78h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">if</span> ( ((__int64 (__fastcall *)(_QWORD, _QWORD, _QWORD, _QWORD))qword_43F0D8[<span class="number">85</span>])(<span class="number">0L</span>L, <span class="number">0L</span>L, <span class="number">0L</span>L, <span class="number">0L</span>L) )</span><br><span class="line">    ((<span class="keyword">void</span> (__fastcall *)(_QWORD))qword_40E0D8[<span class="number">319</span>])(<span class="number">0L</span>L);</span><br><span class="line">  ((<span class="keyword">void</span> (__fastcall *)(<span class="keyword">signed</span> __int64, <span class="keyword">const</span> <span class="keyword">char</span> *, <span class="keyword">signed</span> __int64))qword_43E0D8[<span class="number">283</span>])(<span class="number">1L</span>L, <span class="string">"Enter the flag:\n"</span>, <span class="number">16L</span>L);</span><br><span class="line">  ((<span class="keyword">void</span> (__fastcall *)(_QWORD, <span class="keyword">char</span> *, <span class="keyword">signed</span> __int64))qword_43E0D8[<span class="number">271</span>])(<span class="number">0L</span>L, &amp;v5, <span class="number">32L</span>L);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)sub_4009AE(&amp;v5) != <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v0 = <span class="string">"You are right\n"</span>;</span><br><span class="line">    ((<span class="keyword">void</span> (__fastcall *)(<span class="keyword">signed</span> __int64, <span class="keyword">const</span> <span class="keyword">char</span> *, <span class="keyword">signed</span> __int64))qword_43E0D8[<span class="number">283</span>])(<span class="number">1L</span>L, <span class="string">"You are right\n"</span>, <span class="number">14L</span>L);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v0 = <span class="string">"You are wrong\n"</span>;</span><br><span class="line">    ((<span class="keyword">void</span> (__fastcall *)(<span class="keyword">signed</span> __int64, <span class="keyword">const</span> <span class="keyword">char</span> *, <span class="keyword">signed</span> __int64))qword_43E0D8[<span class="number">283</span>])(<span class="number">1L</span>L, <span class="string">"You are wrong\n"</span>, <span class="number">14L</span>L);</span><br><span class="line">  &#125;</span><br><span class="line">  result = <span class="number">0L</span>L;</span><br><span class="line">  v4 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v3 = v4 ^ v6;</span><br><span class="line">  <span class="keyword">if</span> ( v4 != v6 )</span><br><span class="line">    sub_442480(<span class="number">1L</span>L, v0, v1, v3);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>跟踪到如下ptrace点：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">LOAD:<span class="number">000000000043F</span>380 loc_43F380:                             ; CODE XREF: sub_4009EF+<span class="number">30</span>↑p</span><br><span class="line">LOAD:<span class="number">000000000043F</span>380 lea     rax, [rsp+<span class="number">8</span>]</span><br><span class="line">LOAD:<span class="number">000000000043F</span>385 lea     r8d, [rdi<span class="number">-1</span>]</span><br><span class="line">LOAD:<span class="number">000000000043F</span>389 lea     r10, [rsp<span class="number">-50</span>h]</span><br><span class="line">LOAD:<span class="number">000000000043F</span>38E mov     [rsp<span class="number">-28</span>h], rsi</span><br><span class="line">LOAD:<span class="number">000000000043F</span>393 mov     [rsp<span class="number">-20</span>h], rdx</span><br><span class="line">LOAD:<span class="number">000000000043F</span>398 mov     edi, edi</span><br><span class="line">LOAD:<span class="number">000000000043F</span>39A mov     [rsp<span class="number">-40</span>h], rax</span><br><span class="line">LOAD:<span class="number">000000000043F</span>39F lea     rax, [rsp<span class="number">-30</span>h]</span><br><span class="line">LOAD:<span class="number">000000000043F</span>3A4 cmp     r8d, <span class="number">2</span></span><br><span class="line">LOAD:<span class="number">000000000043F</span>3A8 mov     [rsp<span class="number">-18</span>h], rcx</span><br><span class="line">LOAD:<span class="number">000000000043F</span>3AD movsxd  rsi, dword ptr [rsp<span class="number">-28</span>h]</span><br><span class="line">LOAD:<span class="number">000000000043F</span>3B2 cmova   r10, rcx</span><br><span class="line">LOAD:<span class="number">000000000043F</span>3B6 mov     [rsp<span class="number">-38</span>h], rax</span><br><span class="line">LOAD:<span class="number">000000000043F</span>3BB mov     dword ptr [rsp<span class="number">-48</span>h], <span class="number">18</span>h</span><br><span class="line">LOAD:<span class="number">000000000043F</span>3C3 mov     eax, <span class="number">65</span>h</span><br><span class="line">LOAD:<span class="number">000000000043F</span>3C8 syscall                                 ; LINUX - sys_ptrace</span><br></pre></td></tr></table></figure></p>
<p>我很开心，但是，，，，好吧，我承认我gg与此点，再草了sub_4009AE函数很久之后，放弃了，问一下大佬，说这个ptrace是假的。。。其实有另外一个ptrace函数= =<br>ok，利用gdb catch syscall ptrace 命令，我跟踪到了如下点（一开始就该这么做的=======）：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">   <span class="number">0x4c8eb1</span>:	syscall </span><br><span class="line">=&gt; <span class="number">0x4c8eb3</span>:	cmp    eax,<span class="number">0x0</span></span><br><span class="line">   <span class="number">0x4c8eb6</span>:	jne    <span class="number">0x4c8fdb</span></span><br><span class="line">   <span class="number">0x4c8ebc</span>:	xor    rdi,rdi</span><br><span class="line">   <span class="number">0x4c8ebf</span>:	inc    rdi</span><br><span class="line">   <span class="number">0x4c8ec2</span>:	mov    rsi,<span class="number">0x4a091c</span></span><br><span class="line">[------------------------------------<span class="built_in">stack</span>-------------------------------------]</span><br><span class="line"><span class="number">0000</span>| <span class="number">0x7fffffffcca8</span> --&gt; <span class="number">0x401697</span> (add    rbx,<span class="number">0x1</span>)</span><br><span class="line"><span class="number">0008</span>| <span class="number">0x7fffffffccb0</span> --&gt; <span class="number">0x4002c8</span> (sub    rsp,<span class="number">0x8</span>)</span><br><span class="line"><span class="number">0016</span>| <span class="number">0x7fffffffccb8</span> --&gt; <span class="number">0x6c9018</span> --&gt; <span class="number">0x43a500</span> (mov    rcx,rsi)</span><br><span class="line"><span class="number">0024</span>| <span class="number">0x7fffffffccc0</span> --&gt; <span class="number">0x401620</span> (push   r14)</span><br><span class="line"><span class="number">0032</span>| <span class="number">0x7fffffffccc8</span> --&gt; <span class="number">0x4016b0</span> (push   rbx)</span><br><span class="line"><span class="number">0040</span>| <span class="number">0x7fffffffccd0</span> --&gt; <span class="number">0x0</span> </span><br><span class="line"><span class="number">0048</span>| <span class="number">0x7fffffffccd8</span> --&gt; <span class="number">0x400cae</span> (xor    edi,edi)</span><br><span class="line"><span class="number">0056</span>| <span class="number">0x7fffffffcce0</span> --&gt; <span class="number">0x0</span> </span><br><span class="line">[------------------------------------------------------------------------------]</span><br><span class="line">Legend: code, data, rodata, value</span><br><span class="line"></span><br><span class="line">Catchpoint <span class="number">1</span> (call to syscall ptrace), <span class="number">0x00000000004c8eb3</span> in ?? ()</span><br></pre></td></tr></table></figure></p>
<p>很烦，，，跟踪到如下过程，<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">cmp     eax, <span class="number">0</span></span><br><span class="line">hide:<span class="number">00000000004</span>C8EB6 jnz     locret_4C8FDB</span><br><span class="line">hide:<span class="number">00000000004</span>C8EBC xor     rdi, rdi</span><br><span class="line">hide:<span class="number">00000000004</span>C8EBF inc     rdi</span><br><span class="line">hide:<span class="number">00000000004</span>C8EC2 mov     rsi, offset aEnterTheFlag       ; <span class="string">"Enter the flag:\n"</span></span><br><span class="line">hide:<span class="number">00000000004</span>C8EC9 mov     rdx, <span class="number">10</span>h</span><br><span class="line">hide:<span class="number">00000000004</span>C8ED0 xor     eax, eax</span><br><span class="line">hide:<span class="number">00000000004</span>C8ED2 inc     eax</span><br><span class="line">hide:<span class="number">00000000004</span>C8ED4 syscall                                 ; LINUX - sys_write</span><br><span class="line">hide:<span class="number">00000000004</span>C8ED6 xor     rdi, rdi</span><br><span class="line">hide:<span class="number">00000000004</span>C8ED9 xor     eax, eax</span><br><span class="line">hide:<span class="number">00000000004</span>C8EDB mov     rsi, offset unk_6CCDB0</span><br><span class="line">hide:<span class="number">00000000004</span>C8EE2 mov     rdx, <span class="number">20</span>h</span><br><span class="line">hide:<span class="number">00000000004</span>C8EE9 syscall                                 ; LINUX - sys_read</span><br><span class="line">hide:<span class="number">00000000004</span>C8EEB cmp     eax, <span class="number">0</span></span><br><span class="line">hide:<span class="number">00000000004</span>C8EEE jle     loc_4C8FA9</span><br><span class="line">hide:<span class="number">00000000004</span>C8EF4 mov     rdi, offset unk_6CCDB0</span><br><span class="line">hide:<span class="number">00000000004</span>C8EFB mov     rcx, <span class="number">0F</span>FFFFFFFFFFFFFFFh</span><br><span class="line">hide:<span class="number">00000000004</span>C8F02 xor     eax, eax</span><br><span class="line">hide:<span class="number">00000000004</span>C8F04 repne scasb</span><br><span class="line">hide:<span class="number">00000000004</span>C8F06 <span class="keyword">not</span>     rcx</span><br><span class="line">hide:<span class="number">00000000004</span>C8F09 sub     rcx, <span class="number">1</span></span><br><span class="line">hide:<span class="number">00000000004</span>C8F0D cmp     rcx, <span class="number">15</span>h</span><br><span class="line">hide:<span class="number">00000000004</span>C8F11 jnz     loc_4C8FA9</span><br><span class="line">hide:<span class="number">00000000004</span>C8F17 mov     rdi, offset unk_6CCDB0</span><br><span class="line">hide:<span class="number">00000000004</span>C8F1E cmp     byte ptr [rdi+<span class="number">1</span>], <span class="number">77</span>h</span><br><span class="line">hide:<span class="number">00000000004</span>C8F22 jnz     loc_4C8FA9</span><br><span class="line">hide:<span class="number">00000000004</span>C8F28 cmp     byte ptr [rdi+<span class="number">2</span>], <span class="number">62</span>h</span><br><span class="line">hide:<span class="number">00000000004</span>C8F2C jnz     <span class="keyword">short</span> loc_4C8FA9</span><br><span class="line">hide:<span class="number">00000000004</span>C8F2E cmp     byte ptr [rdi+<span class="number">3</span>], <span class="number">7B</span>h</span><br><span class="line">hide:<span class="number">00000000004</span>C8F32 jnz     <span class="keyword">short</span> loc_4C8FA9</span><br><span class="line">hide:<span class="number">00000000004</span>C8F34 cmp     byte ptr [rdi+<span class="number">14</span>h], <span class="number">7</span>Dh</span><br><span class="line">hide:<span class="number">00000000004</span>C8F38 jnz     <span class="keyword">short</span> loc_4C8FA9</span><br><span class="line">hide:<span class="number">00000000004</span>C8F3A mov     rdi, offset unk_6CCDB4</span><br><span class="line">hide:<span class="number">00000000004</span>C8F41 call    near ptr unk_4C8CC0</span><br><span class="line">hide:<span class="number">00000000004</span>C8F46 mov     rdi, offset unk_6CCDB4</span><br><span class="line">hide:<span class="number">00000000004</span>C8F4D call    near ptr unk_4C8E50</span><br><span class="line">hide:<span class="number">00000000004</span>C8F52 mov     rdi, offset unk_6CCDB4</span><br><span class="line">hide:<span class="number">00000000004</span>C8F59 call    near ptr unk_4C8CC0</span><br><span class="line">hide:<span class="number">00000000004</span>C8F5E mov     rdi, offset unk_6CCDB4</span><br><span class="line">hide:<span class="number">00000000004</span>C8F65 call    near ptr unk_4C8E50</span><br><span class="line">hide:<span class="number">00000000004</span>C8F6A mov     rdi, offset unk_6CCDB4</span><br><span class="line">hide:<span class="number">00000000004</span>C8F71 call    near ptr unk_4C8CC0</span><br><span class="line">hide:<span class="number">00000000004</span>C8F76 mov     rdi, offset unk_6CCDB4</span><br><span class="line">hide:<span class="number">00000000004</span>C8F7D call    near ptr unk_4C8E50</span><br><span class="line">hide:<span class="number">00000000004</span>C8F82 mov     rsi, offset unk_4C8CB0</span><br><span class="line">hide:<span class="number">00000000004</span>C8F89 mov     rdx, <span class="number">0</span></span><br><span class="line">hide:<span class="number">00000000004</span>C8F90</span><br><span class="line">hide:<span class="number">00000000004</span>C8F90 loc_4C8F90:                             ; CODE XREF: hide:<span class="number">00000000004</span>C8FA7↓j</span><br><span class="line">hide:<span class="number">00000000004</span>C8F90 cmp     rdx, <span class="number">10</span>h</span><br><span class="line">hide:<span class="number">00000000004</span>C8F94 jnb     <span class="keyword">short</span> loc_4C8FB2</span><br><span class="line">hide:<span class="number">00000000004</span>C8F96 mov     al, [rdi]</span><br><span class="line">hide:<span class="number">00000000004</span>C8F98 mov     ah, [rsi]</span><br><span class="line">hide:<span class="number">00000000004</span>C8F9A cmp     al, ah</span><br><span class="line">hide:<span class="number">00000000004</span>C8F9C jnz     <span class="keyword">short</span> loc_4C8FA9</span><br><span class="line">hide:<span class="number">00000000004</span>C8F9E inc     rdx</span><br><span class="line">hide:<span class="number">00000000004</span>C8FA1 inc     rdi</span><br><span class="line">hide:<span class="number">00000000004</span>C8FA4 inc     rsi</span><br><span class="line">hide:<span class="number">00000000004</span>C8FA7 jmp     <span class="keyword">short</span> loc_4C8F90</span><br><span class="line">hide:<span class="number">00000000004</span>C8FA9 ; ---------------------------------------------------------------------------</span><br><span class="line">hide:<span class="number">00000000004</span>C8FA9</span><br><span class="line">hide:<span class="number">00000000004</span>C8FA9 loc_4C8FA9:                             ; CODE XREF: hide:<span class="number">00000000004</span>C8EEE↑j</span><br><span class="line">hide:<span class="number">00000000004</span>C8FA9                                         ; hide:<span class="number">00000000004</span>C8F11↑j ...</span><br><span class="line">hide:<span class="number">00000000004</span>C8FA9 mov     rsi, offset aYouAreWrong        ; <span class="string">"You are wrong\n"</span></span><br><span class="line">hide:<span class="number">00000000004</span>C8FB0 jmp     <span class="keyword">short</span> loc_4C8FB9</span><br><span class="line">hide:<span class="number">00000000004</span>C8FB2 ; ---------------------------------------------------------------------------</span><br><span class="line">hide:<span class="number">00000000004</span>C8FB2</span><br><span class="line">hide:<span class="number">00000000004</span>C8FB2 loc_4C8FB2:                             ; CODE XREF: hide:<span class="number">00000000004</span>C8F94↑j</span><br><span class="line">hide:<span class="number">00000000004</span>C8FB2 mov     rsi, offset aYouAreRight        ; <span class="string">"You are right\n"</span></span><br><span class="line">hide:<span class="number">00000000004</span>C8FB9</span><br><span class="line">hide:<span class="number">00000000004</span>C8FB9 loc_4C8FB9:                             ; CODE XREF: hide:<span class="number">00000000004</span>C8FB0↑j</span><br><span class="line">hide:<span class="number">00000000004</span>C8FB9 mov     rdi, <span class="number">1</span></span><br><span class="line">hide:<span class="number">00000000004</span>C8FC0 mov     rdx, <span class="number">0</span>Eh</span><br><span class="line">hide:<span class="number">00000000004</span>C8FC7 xor     eax, eax</span><br><span class="line">hide:<span class="number">00000000004</span>C8FC9 inc     eax</span><br><span class="line">hide:<span class="number">00000000004</span>C8FCB syscall                                 ; LINUX - sys_write</span><br><span class="line">hide:<span class="number">00000000004</span>C8FCD mov     rdi, <span class="number">0</span></span><br><span class="line">hide:<span class="number">00000000004</span>C8FD4 mov     eax, <span class="number">3</span>Ch</span><br><span class="line">hide:<span class="number">00000000004</span>C8FD9 syscall                                 ; LINUX - sys_exit</span><br></pre></td></tr></table></figure></p>
<p>这里面有一点不知道为什么，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hide:00000000004C8F0D cmp     rcx, 15h</span><br></pre></td></tr></table></figure></p>
<p>这一点就是过不去，因为你输入flag换行会自动加0x0a到flag后面，就导致这几句话永远不能为真，额。。。题目链接挂了，我也没证实。<br>逆一下unk_4C8CC0，unk_4C8E50函数，得出结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QWB&#123;f1Nd_TH3HldeC0dE&#125;</span><br></pre></td></tr></table></figure></p>
<p>哎，感觉很正确的好不好- – -就是过不去</p>
<p>最后是solve代码：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ConsoleApplication1.cpp : 定义控制台应用程序的入口点。</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdafx.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> result[<span class="number">4</span>] = &#123;<span class="number">0x7f13b852</span>,<span class="number">0x1bf28c35</span>,<span class="number">0xd28663f4</span>,<span class="number">0x311e4f73</span>&#125;;</span><br><span class="line"></span><br><span class="line">__int64 __<span class="function">fastcall <span class="title">rev1</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	__int64 result = <span class="number">0</span>; <span class="comment">// rax</span></span><br><span class="line">	<span class="keyword">unsigned</span> __int64 v2; <span class="comment">// rt1</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> v3; <span class="comment">// [rsp+18h] [rbp-48h]</span></span><br><span class="line">	__int64 v4; <span class="comment">// [rsp+1Ch] [rbp-44h]</span></span><br><span class="line">	<span class="keyword">signed</span> <span class="keyword">int</span> i; <span class="comment">// [rsp+24h] [rbp-3Ch]</span></span><br><span class="line">	<span class="keyword">signed</span> <span class="keyword">int</span> j; <span class="comment">// [rsp+28h] [rbp-38h]</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> v8; <span class="comment">// [rsp+44h] [rbp-1Ch]</span></span><br><span class="line">	<span class="keyword">int</span> v9; <span class="comment">// [rsp+48h] [rbp-18h]</span></span><br><span class="line">	<span class="keyword">int</span> v10; <span class="comment">// [rsp+4Ch] [rbp-14h]</span></span><br><span class="line">	<span class="keyword">unsigned</span> __int64 v11; <span class="comment">// [rsp+58h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> v7[<span class="number">4</span>] = &#123;<span class="number">0x70493173</span>, <span class="number">0x45723350</span>, <span class="number">0x79523376</span>, <span class="number">0x33593464</span>&#125;;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= <span class="number">1</span>; ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		v3 = *(_DWORD *)(<span class="number">8</span> * i + a1);</span><br><span class="line">		v4 = *(<span class="keyword">unsigned</span> <span class="keyword">int</span> *)(a1 + <span class="number">4</span> + <span class="number">8</span> * i);</span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt;= <span class="number">7</span>; ++j)</span><br><span class="line">		&#123;</span><br><span class="line">			HIDWORD(v4) += <span class="number">1735289196</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt;= <span class="number">7</span>; ++j)</span><br><span class="line">		&#123;</span><br><span class="line">			LODWORD(v4) -= ((*(&amp;v7[<span class="number">0</span>] + ((HIDWORD(v4) &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>)) + HIDWORD(v4)) ^ (((v3 &gt;&gt; <span class="number">5</span>) ^ <span class="number">16</span> * v3) + v3));</span><br><span class="line">			HIDWORD(v4) -= <span class="number">1735289196</span>;</span><br><span class="line">			v3 -= (*(&amp;v7[<span class="number">0</span>] + (BYTE4(v4) &amp; <span class="number">3</span>)) + HIDWORD(v4)) ^ ((((<span class="keyword">unsigned</span> <span class="keyword">int</span>)v4 &gt;&gt; <span class="number">5</span>) ^ <span class="number">16</span> * v4) + v4);			</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">		*(_DWORD *)(a1 + <span class="number">8</span> * i) = v3;</span><br><span class="line">		*(_DWORD *)(a1 + <span class="number">4</span> + <span class="number">8</span> * i) = v4;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">_BYTE *__<span class="function">fastcall <span class="title">rev2</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	_BYTE *result=<span class="number">0</span>; <span class="comment">// rax</span></span><br><span class="line">	<span class="keyword">signed</span> <span class="keyword">int</span> i; <span class="comment">// [rsp+14h] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= <span class="number">15</span>; ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		result = (_BYTE *)(i + a1);</span><br><span class="line">		*result ^= i;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	rev2((__int64)result);</span><br><span class="line">	rev1((__int64)result);</span><br><span class="line">	rev2((__int64)result);</span><br><span class="line">	rev1((__int64)result);</span><br><span class="line">	rev2((__int64)result);</span><br><span class="line">	rev1((__int64)result);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"the result is %s"</span>, result);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>[hide题目链接]<a href="https://pan.baidu.com/s/1q3ey9Kz8ObG5ClL6w75tgA" target="_blank" rel="noopener">https://pan.baidu.com/s/1q3ey9Kz8ObG5ClL6w75tgA</a></p>

      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/04/03/0ctf的g0g0g0解析/" rel="next" title="0ctf的g0g0g0解析">
                <i class="fa fa-chevron-left"></i> 0ctf的g0g0g0解析
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/04/20/ddctf2018-部分writeup/" rel="prev" title="ddctf2018-部分writeup">
                ddctf2018-部分writeup <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">foyjog</p>
              <p class="site-description motion-element" itemprop="description">email:foyjog@163.com</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">19</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              

              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/foyjog" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:foyjog@163.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#概述"><span class="nav-number">1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#思路流程"><span class="nav-number">2.</span> <span class="nav-text">思路流程</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">foyjog</span>

  

  
</div>




  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> v3.4.4</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Pisces</a> v6.3.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.3.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.3.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.3.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.3.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.3.0"></script>



  



  





  










  





  

  

  

  

  
  

  

  

  

  

  

</body>
</html>
