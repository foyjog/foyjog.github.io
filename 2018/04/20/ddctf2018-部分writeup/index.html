<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>ddctf2018-部分writeup | foyjog</title>
  
  
  <!--link rel="stylesheet" href="//cdn.jsdelivr.net/highlight.js/9.10.0/styles/github-gist.min.css"-->
  <link rel="stylesheet" href="//cdn.jsdelivr.net/highlight.js/9.10.0/styles/github-gist.min.css">
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
<div class="Shell">
    <aside class='SideBar'>
    <section class='avatar' style="background-image: url(/assets/header.png)">
        <div class='av-pic' style="background-image: url(/assets/tree_small.png)">
        </div>
    </section>
    <section class='menu'>
        <div>foyjog</div>
        
            <div>reversing engineer</div>
        
        <ul>
          
            <a href="/" class="Btn">
              <li>主页</li>
            </a>  
          
            <a href="/archives/" class="Btn">
              <li>归档</li>
            </a>  
          
        </ul>
    </section>
    <section class="media">
        
    </section>
</aside>

    <div class="container">
        <div data-pager-shell>
            <div>
  <article class='ContentView'>
    <header class='PageTitle'>
        <h1>ddctf2018-部分writeup</h1>
    </header>

    <section>
      <h1 id="╯°□°）╯︵-┻━┻"><a href="#╯°□°）╯︵-┻━┻" class="headerlink" title="(╯°□°）╯︵ ┻━┻"></a>(╯°□°）╯︵ ┻━┻</h1><p>想了很久，对着发呆了一天，然后试了下偏移解码。。。然后就对了，每个十六进制减去128即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">result = [<span class="number">0xd4</span>,<span class="number">0xe8</span>,<span class="number">0xe1</span>,<span class="number">0xf4</span>,<span class="number">0xa0</span>,<span class="number">0xf7</span>,<span class="number">0xe1</span>,<span class="number">0xf3</span>,<span class="number">0xa0</span>,<span class="number">0xe6</span>,<span class="number">0xe1</span>,<span class="number">0xf3</span>,<span class="number">0xf4</span>,<span class="number">0xa1</span>,<span class="number">0xa0</span>,<span class="number">0xd4</span>,<span class="number">0xe8</span>,<span class="number">0xe5</span>,<span class="number">0xa0</span>,<span class="number">0xe6</span>,<span class="number">0xec</span>,<span class="number">0xe1</span>,<span class="number">0xe7</span>,<span class="number">0xa0</span>,<span class="number">0xe9</span>,<span class="number">0xf3</span>,<span class="number">0xba</span>,<span class="number">0xa0</span>,<span class="number">0xc4</span>,<span class="number">0xc4</span>,<span class="number">0xc3</span>,<span class="number">0xd4</span>,<span class="number">0xc6</span>,<span class="number">0xfb</span>,<span class="number">0xb9</span>,<span class="number">0xb2</span>,<span class="number">0xb2</span>,<span class="number">0xe1</span>,<span class="number">0xe2</span>,<span class="number">0xb9</span>,<span class="number">0xb9</span>,<span class="number">0xb7</span>,<span class="number">0xb4</span>,<span class="number">0xe1</span>,<span class="number">0xb4</span>,<span class="number">0xb7</span>,<span class="number">0xe3</span>,<span class="number">0xe4</span>,<span class="number">0xb3</span>,<span class="number">0xb2</span>,<span class="number">0xb2</span>,<span class="number">0xe3</span>,<span class="number">0xe6</span>,<span class="number">0xb4</span>,<span class="number">0xb3</span>,<span class="number">0xe2</span>,<span class="number">0xb5</span>,<span class="number">0xb0</span>,<span class="number">0xb6</span>,<span class="number">0xb1</span>,<span class="number">0xb0</span>,<span class="number">0xe6</span>,<span class="number">0xe1</span>,<span class="number">0xe5</span>,<span class="number">0xe1</span>,<span class="number">0xb5</span>,<span class="number">0xfd</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> result:</span><br><span class="line">    <span class="keyword">print</span> chr(i<span class="number">-128</span>),</span><br></pre></td></tr></table></figure>
<h1 id="第四扩展FS"><a href="#第四扩展FS" class="headerlink" title="第四扩展FS"></a>第四扩展FS</h1><p>题目有混淆，一开始以为文件中的The fourth extended filesystem是提示，当然也是正确的，可以通过把这个ext4文件dd出来，然后挂载，可以得到文件file.zip，但是一直以为是恢复文件啥的来获取密码，搞了好久看题目的意思才想到密码在备注中。。。（Pactera），解压得到file.txt文件，打开全是字母，根据题目提示日常违规审计中频次有时候非常重要，计算文件中每个字母的频次，然后排序，得到flag。</p>
<h1 id="流量分析"><a href="#流量分析" class="headerlink" title="流量分析"></a>流量分析</h1><p>提示为</p>
<blockquote>
<p>提示二：注意补齐私钥格式—–BEGIN RSA PRIVATE KEY—–XXXXXXX—–END RSA PRIVATE KEY—–</p>
</blockquote>
<p>研究ssl传输流，但是需要获取私钥，往流的前面翻，看到一个mime的邮件内容为:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">=20</span><br><span class="line"></span><br><span class="line">=20</span><br><span class="line"></span><br><span class="line">=E5=B0=8F=E5=BC=A0=E4=BD=A0=E5=A5=BD=EF=BC=9A</span><br><span class="line"></span><br><span class="line">=20</span><br><span class="line"></span><br><span class="line">=20</span><br><span class="line"></span><br><span class="line">=E4=BD=A0=E5=A5=BD=EF=BC=8C=E8=AF=B7=E4=BD=A0=E5=B0=86=E5=AF=86=E9=92=A5=E5=AE=89=E8=A3=85=E5=88=B0=E6=9C=8D=E5=8A=A1=E5=99=A8=E4=B8=8A=E3=80=82=E8=B0=A2=E8=B0=A2</span><br><span class="line"></span><br><span class="line">=20</span><br><span class="line"></span><br><span class="line">=20</span><br><span class="line"></span><br><span class="line">=20</span><br></pre></td></tr></table></figure>
<p>解码意思如下：小张你好：你好，请你将密钥安装到服务器上。谢谢<br>随后翻到下面的一张base64加密的图片，解密得到私钥如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">MIICXAIBAAKBgQDCm6vZmclJrVH1AAyGuCuSSZ8O+mIQiOUQCvN0HYbj8153JfSQ</span><br><span class="line">LsJIhbRYS7+zZ1oXvPemWQDv/u/tzegt58q4ciNmcVnq1uKiygc6QOtvT7oiSTyO</span><br><span class="line">vMX/q5iE2iClYUIHZEKX3BjjNDxrYvLQzPyGD1EY2DZIO6T45FNKYC2VDwIDAQAB</span><br><span class="line">AoGAbtWUKUkx37lLfRq7B5sqjZVKdpBZe4tL0jg6cX5Djd3Uhk1inR9UXVNw4/y4</span><br><span class="line">QGfzYqOn8+Cq7QSoBysHOeXSiPztW2cL09ktPgSlfTQyN6ELNGuiUOYnaTWYZpp/</span><br><span class="line">QbRcZ/eHBulVQLlk5M6RVs9BLI9X08RAl7EcwumiRfWas6kCQQDvqC0dxl2wIjwN</span><br><span class="line">czILcoWLig2c2u71Nev9DrWjWHU8eHDuzCJWvOUAHIrkexddWEK2VHd+F13GBCOQ</span><br><span class="line">ZCM4prBjAkEAz+ENahsEjBE4+7H1HdIaw0+goe/45d6A2ewO/lYH6dDZTAzTW9z9</span><br><span class="line">kzV8uz+Mmo5163/JtvwYQcKF39DJGGtqZQJBAKa18XR16fQ9TFL64EQwTQ+tYBzN</span><br><span class="line">+04eTWQCmH3haeQ/0Cd9XyHBUveJ42Be8/jeDcIx7dGLxZKajHbEAfBFnAsCQGq1</span><br><span class="line">AnbJ4Z6opJCGu+UP2c8SC8m0bhZJDelPRC8IKE28eB6SotgP61ZqaVmQ+HLJ1/wH</span><br><span class="line">/5pfc3AmEyRdfyx6zwUCQCAH4SLJv/kprRz1a1gx8FR5tj4NeHEFFNEgq1gmiwmH</span><br><span class="line">2STT5qZWzQFz8NRe+/otNOHBR2Xk4e8IS+ehIJ3TvyE=</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br></pre></td></tr></table></figure></p>
<p>通过wireshark本身的解密功能，得到flag： DDCTF{efd2a79ae9ae5008694a3561fb55470e}</p>
<h1 id="安全通信"><a href="#安全通信" class="headerlink" title="安全通信"></a>安全通信</h1><p>这个题目看懂python即，sha1加密，加密位数为16位，所以通过agentid来不断使整个输入位数增长或者减少即可实现解密。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">angent_ID = <span class="string">"11111111"</span></span><br><span class="line">flag = [<span class="number">31</span>]*<span class="number">33</span></span><br><span class="line">result = <span class="string">''</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">count = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> count != <span class="number">-1</span>:</span><br><span class="line">    p = remote(<span class="string">"116.85.48.103"</span>,<span class="number">5002</span>)</span><br><span class="line">    p.recv()</span><br><span class="line">    p.sendline(<span class="string">"f49348cf84d390da52498077ae7137d5"</span>)</span><br><span class="line">    p.recv()</span><br><span class="line">    p.sendline(angent_ID)</span><br><span class="line">    ret =  p.recvline()</span><br><span class="line">    p.recv()</span><br><span class="line">    last32 = ret[len(ret)<span class="number">-33</span><span class="number">-32</span><span class="number">-32</span>:len(ret)<span class="number">-33</span><span class="number">-32</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:   </span><br><span class="line">        msg = <span class="string">"Connection for mission: "</span>+angent_ID+<span class="string">", your mission's flag is: DDCTF&#123;"</span> </span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> flag:</span><br><span class="line">            msg +=x</span><br><span class="line">        p.sendline(msg)</span><br><span class="line">        ret =  p.recvline()</span><br><span class="line">        last32_1 = ret[len(ret)<span class="number">-33</span><span class="number">-32</span><span class="number">-32</span>:len(ret)<span class="number">-1</span><span class="number">-32</span><span class="number">-32</span>]</span><br><span class="line">        <span class="keyword">if</span> last32_1 == last32:</span><br><span class="line">            result += flag[count]</span><br><span class="line">            count = count - <span class="number">1</span> </span><br><span class="line">            angent_ID += <span class="string">'1'</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        flag[count] = chr(ord(flag[count])+<span class="number">1</span>)</span><br><span class="line">        p.recv()</span><br><span class="line">    p.close()</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span>   result[::<span class="number">-1</span>]</span><br></pre></td></tr></table></figure></p>
<p>代码是最后得出一部分flag的修改版本，所以应该只能跑出flag的第一位，要跑出其他稍加变换即可。</p>
<h1 id="Baby-MIPS"><a href="#Baby-MIPS" class="headerlink" title="Baby MIPS"></a>Baby MIPS</h1><p>题目很坑，竟然是一个不能运行的程序，时间都花在考虑如何让它跑起来了，后来放弃之后认真看了下这一段非常长的代码，才发现是一个16<em>16的线性方程组，是真滴坑。<br>下面是获取16</em>16参数和16个结果的idapython：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">start = <span class="number">0x400430</span></span><br><span class="line">end = <span class="number">0x4017a9</span></span><br><span class="line">end2 = <span class="number">0x004017A8</span></span><br><span class="line">op = <span class="string">''</span></span><br><span class="line">v0 = <span class="number">0</span></span><br><span class="line">number = <span class="number">8</span></span><br><span class="line">result = <span class="number">1028</span>*[<span class="number">1</span>]  </span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> range(start,end2):</span><br><span class="line">    <span class="keyword">if</span> GetOpnd(line,<span class="number">2</span>) != <span class="string">''</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    opnd1 = str(hex(number + <span class="number">4</span>))+<span class="string">'($fp)'</span></span><br><span class="line">    <span class="keyword">if</span>(idc.GetOpnd(line,<span class="number">1</span>).lower() == opnd1):</span><br><span class="line">        number = number + <span class="number">4</span></span><br><span class="line">    <span class="keyword">if</span> idc.GetMnem(line) == <span class="string">'sw'</span>:</span><br><span class="line">        result[number] = v0</span><br><span class="line">    <span class="keyword">if</span> idc.GetMnem(line) == <span class="string">'li'</span>:</span><br><span class="line">        v0 = int(GetOpnd(line,<span class="number">1</span>),<span class="number">16</span>)</span><br><span class="line">    <span class="keyword">if</span> idc.GetMnem(line) == <span class="string">'lw'</span>:</span><br><span class="line">        v0 = result[number]</span><br><span class="line">    <span class="keyword">if</span> idc.GetMnem(line) == <span class="string">'sra'</span>:</span><br><span class="line">        n = int(GetOpnd(line,<span class="number">1</span>),<span class="number">16</span>)</span><br><span class="line">        v0 = v0 &gt;&gt; n</span><br><span class="line">    <span class="keyword">if</span> idc.GetMnem(line) == <span class="string">'xori'</span>:</span><br><span class="line">        n = int(GetOpnd(line,<span class="number">1</span>),<span class="number">16</span>)</span><br><span class="line">        v0 = v0 ^ n</span><br><span class="line">    <span class="keyword">if</span> idc.GetMnem(line) == <span class="string">'sll'</span>:</span><br><span class="line">        n = int(GetOpnd(line,<span class="number">1</span>),<span class="number">16</span>)</span><br><span class="line">        v0 = v0 &lt;&lt; n</span><br><span class="line">  </span><br><span class="line">j = <span class="number">0</span>      </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>,len(result)/<span class="number">4</span>):</span><br><span class="line">    <span class="keyword">print</span> hex(result[i*<span class="number">4</span>]),</span><br><span class="line">    j = j +<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> j%<span class="number">16</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">''</span></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">start = <span class="number">0x400430</span></span><br><span class="line">end = <span class="number">0x004017A8</span></span><br><span class="line">op = <span class="string">''</span></span><br><span class="line">v0 = <span class="number">0</span></span><br><span class="line">number = <span class="number">8</span></span><br><span class="line">result = <span class="number">1028</span>*[<span class="number">1</span>] </span><br><span class="line">result2 = [] </span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> range(start,end):</span><br><span class="line">    <span class="keyword">if</span> GetOpnd(line,<span class="number">2</span>) != <span class="string">''</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    opnd1 = str(hex(number + <span class="number">4</span>))+<span class="string">'($fp)'</span></span><br><span class="line">    <span class="keyword">if</span>(idc.GetOpnd(line,<span class="number">1</span>).lower() == opnd1):</span><br><span class="line">        number = number + <span class="number">4</span></span><br><span class="line">    <span class="keyword">if</span> idc.GetMnem(line) == <span class="string">'sw'</span>:</span><br><span class="line">        result[number] = v0</span><br><span class="line">    <span class="keyword">if</span> idc.GetMnem(line) == <span class="string">'li'</span>:</span><br><span class="line">        v0 = int(GetOpnd(line,<span class="number">1</span>),<span class="number">16</span>)</span><br><span class="line">    <span class="keyword">if</span> idc.GetMnem(line) == <span class="string">'lw'</span>:</span><br><span class="line">        v0 = result[number]</span><br><span class="line">    <span class="keyword">if</span> idc.GetMnem(line) == <span class="string">'sra'</span>:</span><br><span class="line">        n = int(GetOpnd(line,<span class="number">1</span>),<span class="number">16</span>)</span><br><span class="line">        v0 = v0 &gt;&gt; n</span><br><span class="line">    <span class="keyword">if</span> idc.GetMnem(line) == <span class="string">'xori'</span>:</span><br><span class="line">        n = int(GetOpnd(line,<span class="number">1</span>),<span class="number">16</span>)</span><br><span class="line">        v0 = v0 ^ n</span><br><span class="line">    <span class="keyword">if</span> idc.GetMnem(line) == <span class="string">'sll'</span>:</span><br><span class="line">        n = int(GetOpnd(line,<span class="number">1</span>),<span class="number">16</span>)</span><br><span class="line">        v0 = v0 &lt;&lt; n</span><br><span class="line"></span><br><span class="line">start = <span class="number">0x004017B0</span>  </span><br><span class="line">end = <span class="number">0x0040312C</span></span><br><span class="line"></span><br><span class="line">number = <span class="number">8</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> range(start,end):</span><br><span class="line">    <span class="keyword">if</span> idc.GetMnem(line) == <span class="string">'lw'</span>:</span><br><span class="line">        <span class="keyword">if</span> idc.GetOpnd(line,<span class="number">0</span>) == <span class="string">"$v1"</span>:</span><br><span class="line">            number = number + <span class="number">4</span></span><br><span class="line">    <span class="keyword">if</span> idc.GetMnem(line) == <span class="string">'negu'</span>:</span><br><span class="line">        result[number] = - result[number]</span><br><span class="line">        number = number + <span class="number">4</span></span><br><span class="line">    <span class="keyword">if</span> idc.GetMnem(line) == <span class="string">'subu'</span>:</span><br><span class="line">        result[number] = - result[number]</span><br><span class="line">        number = number + <span class="number">4</span></span><br><span class="line">    <span class="keyword">if</span> idc.GetMnem(line) == <span class="string">'addu'</span>:</span><br><span class="line">        number = number + <span class="number">4</span></span><br><span class="line">    <span class="keyword">if</span> idc.GetMnem(line) == <span class="string">'li'</span>:</span><br><span class="line">        <span class="keyword">if</span> idc.GetOpnd(line,<span class="number">0</span>) == <span class="string">"$v0"</span>:</span><br><span class="line">            result2.append(GetOpnd(line,<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> result2:</span><br><span class="line">    <span class="keyword">print</span> x,</span><br></pre></td></tr></table></figure></p>
<p>得出参数后用python解方程：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">A = np.array([[<span class="number">-0xdbbb</span>,<span class="number">0xfbf1</span>,<span class="number">-0xf15b</span>,<span class="number">0x7529</span>,<span class="number">-0x41d5</span>,<span class="number">0x863</span>,<span class="number">-0xcb16</span>,<span class="number">-0x8db6</span>,<span class="number">-0x853c</span>,<span class="number">-0x47c</span>,<span class="number">0x706</span>,<span class="number">-0xa9bc</span>,<span class="number">-0x3f16</span>,<span class="number">-0xdb17</span>,<span class="number">-0x450d</span>,<span class="number">-0xa318</span>],</span><br><span class="line">[<span class="number">-0x99ba</span>,<span class="number">0xf90a</span>,<span class="number">0xc551</span>,<span class="number">0x95c</span>,<span class="number">-0x9248</span>,<span class="number">0xaa41</span>,<span class="number">0x4c0c</span>,<span class="number">-0x1250</span>,<span class="number">-0xf595</span>,<span class="number">-0x50b7</span>,<span class="number">0xa0d5</span>,<span class="number">0xeeb9</span>,<span class="number">0x788e</span>,<span class="number">0x9550</span>,<span class="number">-0x259</span>,<span class="number">0xd28b</span>],</span><br><span class="line">[<span class="number">0x68ae</span>,<span class="number">-0xe608</span>,<span class="number">0x3a51</span>,<span class="number">-0x54f7</span>,<span class="number">-0x3061</span>,<span class="number">0xda99</span>,<span class="number">-0x50ea</span>,<span class="number">0x6141</span>,<span class="number">0x9c6d</span>,<span class="number">0x264d</span>,<span class="number">0x623b</span>,<span class="number">0x9b21</span>,<span class="number">-0x55c0</span>,<span class="number">-0xa758</span>,<span class="number">0x9431</span>,<span class="number">-0x216f</span>],</span><br><span class="line">[<span class="number">-0xae5</span>,<span class="number">0xd06f</span>,<span class="number">0x416b</span>,<span class="number">0xd3b3</span>,<span class="number">-0x7544</span>,<span class="number">0x9bec</span>,<span class="number">-0x7f46</span>,<span class="number">0xebb2</span>,<span class="number">0x3693</span>,<span class="number">0x6aab</span>,<span class="number">-0x7714</span>,<span class="number">0xbad2</span>,<span class="number">0x92b2</span>,<span class="number">0xfd92</span>,<span class="number">-0x6d1</span>,<span class="number">0x6c15</span>],</span><br><span class="line">[<span class="number">0x9db6</span>,<span class="number">0x197b</span>,<span class="number">0x3444</span>,<span class="number">-0xd0a5</span>,<span class="number">-0x4aa</span>,<span class="number">0x1e74</span>,<span class="number">-0x7c47</span>,<span class="number">-0xca9a</span>,<span class="number">-0x9d3c</span>,<span class="number">-0xde33</span>,<span class="number">0xe1d3</span>,<span class="number">0x5aee</span>,<span class="number">-0x1699</span>,<span class="number">0xf055</span>,<span class="number">-0x1b48</span>,<span class="number">-0x1ca7</span>],</span><br><span class="line">[<span class="number">-0xdedc</span>,<span class="number">-0xfc3d</span>,<span class="number">-0xf38f</span>,<span class="number">0xa44</span>,<span class="number">0x53f5</span>,<span class="number">0x328b</span>,<span class="number">-0xea66</span>,<span class="number">0x1b3</span>,<span class="number">0x3aa1</span>,<span class="number">-0xffb</span>,<span class="number">0x58d7</span>,<span class="number">0x1325</span>,<span class="number">0xbea3</span>,<span class="number">-0xa8c3</span>,<span class="number">0x148f</span>,<span class="number">-0x80e2</span>],</span><br><span class="line">[<span class="number">0xd5e8</span>,<span class="number">0xa05d</span>,<span class="number">0x5809</span>,<span class="number">-0xdc99</span>,<span class="number">0xb4ec</span>,<span class="number">0x4d4b</span>,<span class="number">-0x9cf4</span>,<span class="number">0x828</span>,<span class="number">0x7fc</span>,<span class="number">0x67cf</span>,<span class="number">-0x1457</span>,<span class="number">0x797a</span>,<span class="number">-0x5d1e</span>,<span class="number">0x548a</span>,<span class="number">0xb69e</span>,<span class="number">0x358a</span>],</span><br><span class="line">[<span class="number">-0x9cf0</span>,<span class="number">-0xa976</span>,<span class="number">0xbe4e</span>,<span class="number">-0x634f</span>,<span class="number">0x53cc</span>,<span class="number">-0x8f6a</span>,<span class="number">-0x5e37</span>,<span class="number">-0x33af</span>,<span class="number">-0xcbe0</span>,<span class="number">0xc24e</span>,<span class="number">0xd5b5</span>,<span class="number">-0x7f7c</span>,<span class="number">0x4f09</span>,<span class="number">0x53d4</span>,<span class="number">0xbe5d</span>,<span class="number">0x3b33</span>],</span><br><span class="line">[<span class="number">0x962e</span>,<span class="number">-0x370</span>,<span class="number">-0x98b</span>,<span class="number">0xc537</span>,<span class="number">-0xb77d</span>,<span class="number">-0xdb72</span>,<span class="number">-0x9112</span>,<span class="number">-0x2377</span>,<span class="number">-0x4a98</span>,<span class="number">-0xee3c</span>,<span class="number">-0x71f</span>,<span class="number">-0x5422</span>,<span class="number">0xab78</span>,<span class="number">-0x102d</span>,<span class="number">-0x4baa</span>,<span class="number">-0xbab4</span>],</span><br><span class="line">[<span class="number">0x1438</span>,<span class="number">0x47e0</span>,<span class="number">-0xd25c</span>,<span class="number">0x8d17</span>,<span class="number">-0x7d78</span>,<span class="number">0xba6c</span>,<span class="number">0x4302</span>,<span class="number">0x150e</span>,<span class="number">-0x7415</span>,<span class="number">0x3887</span>,<span class="number">0x2233</span>,<span class="number">0x598</span>,<span class="number">-0xb1ce</span>,<span class="number">-0x1fd4</span>,<span class="number">-0xdd2f</span>,<span class="number">-0xbc7e</span>],</span><br><span class="line">[<span class="number">0x75fb</span>,<span class="number">-0xc618</span>,<span class="number">-0x6ba8</span>,<span class="number">-0x3ecb</span>,<span class="number">0xe22</span>,<span class="number">0x24e</span>,<span class="number">0xad11</span>,<span class="number">0x5065</span>,<span class="number">0x82a2</span>,<span class="number">-0x1e3f</span>,<span class="number">-0xa843</span>,<span class="number">-0x3f6a</span>,<span class="number">0xb29b</span>,<span class="number">-0xaf63</span>,<span class="number">0xa551</span>,<span class="number">0xc070</span>],</span><br><span class="line">[<span class="number">0xa6d1</span>,<span class="number">-0x7e2b</span>,<span class="number">-0x4ad4</span>,<span class="number">0x15da</span>,<span class="number">0x70c6</span>,<span class="number">0x1f7b</span>,<span class="number">0xe2f7</span>,<span class="number">-0xed33</span>,<span class="number">-0x7d70</span>,<span class="number">-0x1bd8</span>,<span class="number">0xb3a1</span>,<span class="number">-0x6153</span>,<span class="number">0xf9a6</span>,<span class="number">0x47fb</span>,<span class="number">-0xc8d0</span>,<span class="number">0x585b</span>],</span><br><span class="line">[<span class="number">-0xe0ad</span>,<span class="number">0x5102</span>,<span class="number">-0x7e1e</span>,<span class="number">0xdabb</span>,<span class="number">0x682a</span>,<span class="number">0x92ae</span>,<span class="number">-0xc921</span>,<span class="number">0x35a5</span>,<span class="number">0x7ec7</span>,<span class="number">-0xb51</span>,<span class="number">-0x9ac6</span>,<span class="number">-0xd4fb</span>,<span class="number">0xc62d</span>,<span class="number">-0x6049</span>,<span class="number">-0x45b9</span>,<span class="number">-0xf376</span>],</span><br><span class="line">[<span class="number">-0x3d64</span>,<span class="number">-0x9578</span>,<span class="number">0xfbdc</span>,<span class="number">-0x9294</span>,<span class="number">-0xf06f</span>,<span class="number">0x34e0</span>,<span class="number">0x3278</span>,<span class="number">0x57f</span>,<span class="number">-0xf917</span>,<span class="number">-0xd741</span>,<span class="number">-0xb5cf</span>,<span class="number">-0x8ed2</span>,<span class="number">-0x50e8</span>,<span class="number">0x80f</span>,<span class="number">-0x1a0c</span>,<span class="number">0x2372</span>],</span><br><span class="line">[<span class="number">0xb982</span>,<span class="number">0x48b3</span>,<span class="number">0xccc0</span>,<span class="number">0xc23</span>,<span class="number">0x7db1</span>,<span class="number">-0xa334</span>,<span class="number">0x2b00</span>,<span class="number">0x1c37</span>,<span class="number">0x1614</span>,<span class="number">0x371</span>,<span class="number">0x685f</span>,<span class="number">-0x6f1c</span>,<span class="number">0xb3fd</span>,<span class="number">-0x110</span>,<span class="number">-0x7edb</span>,<span class="number">-0x24d8</span>],</span><br><span class="line">[<span class="number">-0xe63a</span>,<span class="number">-0x8b69</span>,<span class="number">0x8b7c</span>,<span class="number">0xae91</span>,<span class="number">0xb34e</span>,<span class="number">0x8f06</span>,<span class="number">0x9696</span>,<span class="number">0x2db</span>,<span class="number">0xc346</span>,<span class="number">0x1a47</span>,<span class="number">0xf056</span>,<span class="number">-0x8b03</span>,<span class="number">-0x991f</span>,<span class="number">-0xab6e</span>,<span class="number">-0xdc59</span>,<span class="number">-0x63af</span>]])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">B = np.array([<span class="number">0xFE8E3EBA</span>, <span class="number">0x1061309</span> ,<span class="number">0x84D6C3</span>, <span class="number">0x19B6934</span>, <span class="number">0xFF9E94D4</span>, <span class="number">0xFF141D3B</span>, <span class="number">0x12A6103</span>, <span class="number">0xFFFD20AD</span>, <span class="number">0xFED51449</span> ,<span class="number">0xFF3D61C1</span>, <span class="number">0x624DA6</span>, <span class="number">0xFFD43532</span>, <span class="number">0xFFB6AD60</span>, <span class="number">0xFEDEA130</span>, <span class="number">0x8862D9</span>,<span class="number">0x3B7496</span>])</span><br><span class="line"></span><br><span class="line">B2 = np.array([<span class="number">-24232262</span>, <span class="number">0x1061309</span> ,<span class="number">0x84D6C3</span>, <span class="number">0x19B6934</span>, <span class="number">-6384428</span>, <span class="number">-15459013</span>, <span class="number">0x12A6103</span>, <span class="number">-188243</span>, <span class="number">-19590071</span> ,<span class="number">-12754495</span>, <span class="number">0x624DA6</span>, <span class="number">-2869966</span>, <span class="number">-4805280</span>, <span class="number">-18964176</span>, <span class="number">0x8862D9</span>,<span class="number">0x3B7496</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">x = np.linalg.solve(A, B2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> ((x))</span><br></pre></td></tr></table></figure></p>
<h1 id="黑盒破解"><a href="#黑盒破解" class="headerlink" title="黑盒破解"></a>黑盒破解</h1><p>这题目应该是最有意思的一个题目了,整个函数就围绕着 new2720_v4 = (struct_a1 *)operator new(0xAA0uLL);整个结构体展开，重点实在解密出每个字母对应的函数<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">__int64 __<span class="function">fastcall <span class="title">sub_401A48</span><span class="params">(struct_a1 *new2720_v4_2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> v2; <span class="comment">// [rsp+13h] [rbp-1Dh]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+14h] [rbp-1Ch]</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> j; <span class="comment">// [rsp+18h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( new2720_v4_2 &amp;&amp; new2720_v4_2 != (struct_a1 *)<span class="number">-16L</span>L )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(new2720_v4_2-&gt;passcode); ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      v2 = new2720_v4_2-&gt;passcode[i];</span><br><span class="line">      <span class="keyword">if</span> ( i + <span class="number">1</span> != <span class="built_in">strlen</span>(new2720_v4_2-&gt;passcode) )</span><br><span class="line">        new2720_v4_2-&gt;byte298 = new2720_v4_2-&gt;passcode[i + <span class="number">1</span>];</span><br><span class="line">      <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">8</span>; ++j )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( byte_603900[v2] != *((_BYTE *)&amp;new2720_v4_2-&gt;dword198</span><br><span class="line">                                + *((<span class="keyword">signed</span> <span class="keyword">int</span> *)&amp;new2720_v4_2-&gt;input_str_encode + j + <span class="number">72L</span>L)) )</span><br><span class="line">        &#123;</span><br><span class="line">          new2720_v4_2-&gt;qword2A0 = *(&amp;new2720_v4_2-&gt;input_str_encode</span><br><span class="line">                                   + *((<span class="keyword">signed</span> <span class="keyword">int</span> *)&amp;new2720_v4_2-&gt;input_str_encode + j + <span class="number">72L</span>L)</span><br><span class="line">                                   + <span class="number">84L</span>L);</span><br><span class="line">          ((<span class="keyword">void</span> (__fastcall *)(struct_a1 *))new2720_v4_2-&gt;qword2A0)(new2720_v4_2);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>认真分析是比较输入的字符，然后跟八个opcode去比较，是哪个就执行哪个函数：八个函数就不贴了，八个opcode分别是：$  0  C  E  8  t  u  ;  #<br>嗯，分析每个opcode的函数相应的操作就可以了：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$： a1-&gt;<span class="number">299</span> = *(a1-&gt;<span class="number">120</span>+a1-&gt;<span class="number">8</span>) </span><br><span class="line"><span class="number">0</span>:  ++(a1-&gt;<span class="number">120</span>)</span><br><span class="line"><span class="number">8</span>:  *(a1-&gt;<span class="number">120</span>+a1-&gt;<span class="number">8</span>) = a1-&gt;<span class="number">299</span></span><br><span class="line">C:  a1-&gt;<span class="number">299</span> = a1-&gt;<span class="number">299</span> + a1-&gt;<span class="number">298</span> - <span class="number">33</span></span><br><span class="line">E:  关键输出函数，<span class="keyword">if</span> ( a1-&gt;byte298 == <span class="number">0x73</span> ),输出</span><br><span class="line">t:  a1-&gt;<span class="number">299</span> = a1-&gt;<span class="number">299</span> - a1-&gt;<span class="number">298</span> + <span class="number">33</span></span><br><span class="line">u:  --(a1-&gt;<span class="number">120</span>)</span><br><span class="line">;   <span class="keyword">for</span> ( i = <span class="number">0</span>; (<span class="keyword">char</span>)a1-&gt;byte298 &gt; i; ++i )</span><br><span class="line">    ++a1-&gt;dword120;</span><br></pre></td></tr></table></figure></p>
<p>题目提示要输出Binggo即可,所以调出Binggo即可。<br>6030e0地址中的字符如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PaF0!&amp;Prv&#125;H&#123;ojDQ#7v=2o,wK@8Em/ry2w|n_yWN*z-*sW5vs!&gt;Q8?M&gt;Ue*&#125;&lt;&amp;!c_v?Wz98&gt;79U&#125;LKR&amp;O-3,s2=)!ac&apos;fm,v#WbU5Cv:M&quot;WQa&quot;i%BLT5\&lt;qBI#AK%60ixtn+Kn^Ontp]O9Sr(Nm27H&#125;QM&gt;&lt;iE,x)yN?ok]L##jE&quot;-4i-t&#125;;AzD4&quot;^iEC\3TrZ%55)|3:.YLv&#123;7(cnxA_AsYRXyD&amp;|3U_z^yR/Kpqp6lT/pdv8tp,\^Y7T+oLsvf</span><br></pre></td></tr></table></figure></p>
<ol>
<li>a1-&gt;120参数可以用作输出的偏移，利用0和u操作单次改变偏移，利用;+偏移量来指定较大偏移量加值</li>
<li>*(a1-&gt;120+a1-&gt;8) 可以用作赋值给a1-&gt;299的中间变量</li>
<li>t和C+一个偏移量可以用作输入赋值</li>
<li>利用8来给6030e0中a1-&gt;120偏移赋值</li>
<li>利用Es使得a1-&gt;byte298 == 0x73输出Binggo</li>
</ol>
<p>一开始我从6030e0开始输入Binggo，后来发现无论如何都无法写入00，看到如下函数：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// *(a1-&gt;120+a1-&gt;8) = a1-&gt;299</span></span><br><span class="line"><span class="keyword">signed</span> __int64 __<span class="function">fastcall <span class="title">funcchr8</span><span class="params">(struct_a1 *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ( !a1 || a1-&gt;dword120 &gt;= a1-&gt;dword124 || !a1-&gt;byte299 )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">  *(_BYTE *)((<span class="keyword">signed</span> <span class="keyword">int</span>)a1-&gt;dword120 + a1-&gt;input_str_encode) = a1-&gt;byte299;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1L</span>L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>发现并不行，所以换渠道，直接将Binggo写入6030e0的最后几个字符中，然后被6030e0最后自己的00截断即可。<br>我的指令如下：</p>
<blockquote>
<p>;|;}Cc80CH80C&amp;80t(8080C)80totFC%8uuuuuuEs</p>
</blockquote>
<h1 id="被隐藏的真实"><a href="#被隐藏的真实" class="headerlink" title="被隐藏的真实"></a>被隐藏的真实</h1><p>好假的题目，重点是题目竟然偷偷换掉了memcmp函数。。纠结<br>题目有三关，第一关第二关比较好过，直接逆向可以得出Correct。<br>第三关因为偷偷换掉了memcmp函数，所以比较郁闷。<br>重点代码verify()如下：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall Bitcoin::verify(Bitcoin *<span class="keyword">this</span>, <span class="keyword">char</span> *a2)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v2; <span class="comment">// ebx</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">void</span> *v3; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">void</span> *v5; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> v8; <span class="comment">// [rsp+1Bh] [rbp-85h]</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// [rsp+1Ch] [rbp-84h]</span></span><br><span class="line">  <span class="keyword">char</span> v10; <span class="comment">// [rsp+20h] [rbp-80h]</span></span><br><span class="line">  <span class="keyword">char</span> v11; <span class="comment">// [rsp+40h] [rbp-60h]</span></span><br><span class="line">  <span class="keyword">char</span> v12; <span class="comment">// [rsp+60h] [rbp-40h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v13; <span class="comment">// [rsp+88h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v13 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">if</span> ( counter == <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v2 = *(_DWORD *)a2;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( counter == <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">std</span>::allocator&lt;<span class="keyword">char</span>&gt;::allocator(&amp;v8);</span><br><span class="line">    <span class="built_in">std</span>::__cxx11::basic_string&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;,<span class="built_in">std</span>::allocator&lt;<span class="keyword">char</span>&gt;&gt;::basic_string(&amp;v11, a2, &amp;v8);</span><br><span class="line">    sha256((__int64)&amp;v12, (__int64)&amp;v11, <span class="number">0</span>);</span><br><span class="line">    v3 = (<span class="keyword">const</span> <span class="keyword">void</span> *)<span class="built_in">std</span>::__cxx11::basic_string&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;,<span class="built_in">std</span>::allocator&lt;<span class="keyword">char</span>&gt;&gt;::c_str(&amp;v12, &amp;v11);</span><br><span class="line">    <span class="keyword">if</span> ( !<span class="built_in">memcmp</span>(v3, &amp;hashes, <span class="number">0x20</span>uLL) )</span><br><span class="line">      v4 = secret_const[counter];</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v4 = *((_DWORD *)<span class="keyword">this</span> + <span class="number">2</span>);</span><br><span class="line">    v2 = v4;</span><br><span class="line">    <span class="built_in">std</span>::__cxx11::basic_string&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;,<span class="built_in">std</span>::allocator&lt;<span class="keyword">char</span>&gt;&gt;::~basic_string(&amp;v12);</span><br><span class="line">    <span class="built_in">std</span>::__cxx11::basic_string&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;,<span class="built_in">std</span>::allocator&lt;<span class="keyword">char</span>&gt;&gt;::~basic_string(&amp;v11);</span><br><span class="line">    <span class="built_in">std</span>::allocator&lt;<span class="keyword">char</span>&gt;::~allocator(&amp;v8);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">std</span>::allocator&lt;<span class="keyword">char</span>&gt;::allocator(&amp;v8);</span><br><span class="line">    <span class="built_in">std</span>::__cxx11::basic_string&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;,<span class="built_in">std</span>::allocator&lt;<span class="keyword">char</span>&gt;&gt;::basic_string(&amp;v10, (__int64)a2, <span class="number">80L</span>L);</span><br><span class="line">    sha256((__int64)&amp;v11, (__int64)&amp;v10, <span class="number">0</span>);</span><br><span class="line">    sha256((__int64)&amp;v12, (__int64)&amp;v11, <span class="number">1</span>);</span><br><span class="line">    v5 = (<span class="keyword">const</span> <span class="keyword">void</span> *)<span class="built_in">std</span>::__cxx11::basic_string&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;,<span class="built_in">std</span>::allocator&lt;<span class="keyword">char</span>&gt;&gt;::c_str(&amp;v12, &amp;v11);</span><br><span class="line">    <span class="keyword">if</span> ( !<span class="built_in">memcmp</span>(v5, &amp;hashes, <span class="number">32u</span>LL) )</span><br><span class="line">      v6 = secret_const[counter];</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v6 = *((_DWORD *)<span class="keyword">this</span> + <span class="number">2</span>);</span><br><span class="line">    v9 = v6;</span><br><span class="line">    <span class="built_in">std</span>::__cxx11::basic_string&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;,<span class="built_in">std</span>::allocator&lt;<span class="keyword">char</span>&gt;&gt;::~basic_string(&amp;v12);</span><br><span class="line">    <span class="built_in">std</span>::__cxx11::basic_string&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;,<span class="built_in">std</span>::allocator&lt;<span class="keyword">char</span>&gt;&gt;::~basic_string(&amp;v11);</span><br><span class="line">    <span class="built_in">std</span>::__cxx11::basic_string&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;,<span class="built_in">std</span>::allocator&lt;<span class="keyword">char</span>&gt;&gt;::~basic_string(&amp;v10);</span><br><span class="line">    <span class="built_in">std</span>::allocator&lt;<span class="keyword">char</span>&gt;::~allocator(&amp;v8);</span><br><span class="line">    v2 = v9;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>第三关是输入字符串，然后两次sha256，第二个sha256有反转，最后和hashes比较即可，但是memcmp被换掉了，所以跟进去，可以得到真正要比较的值是：</p>
<blockquote>
<p>6fe28c0ab6f1b372c1a6a246ae63f74f931e8365e15a089c68d6190000000000 </p>
</blockquote>
<p>网页搜索一下，得到输入值<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0100000000000000000000000000000000000000000000000000000000000000000000003ba3edfd7a7b12b27ac72c3e67768f617fc81bc3888a51323a9fb8aa4b1e5e4a29ab5f49ffff001d1dac2b7c</span><br></pre></td></tr></table></figure></p>
<p>但是提交不对，说是要最短输入，更改第二个输入，发现0094EA58ADC3AA65F5C26F6ED27D3FDB0D093DC17F8DC81929不是唯一能通过第二关的值，最短是的值是0094EA58ADC3AA65F5C26F6ED27D3FDB0D093DC17F，没有细究，拿分要紧， 得到flag：</p>
<blockquote>
<p>DDCTF{ea1b1cead2021eea14f8e51c60876c15e518076e79dfb62b952d4a7e623cd01a}</p>
</blockquote>
<h1 id="探寻逝去的Atlantis文明"><a href="#探寻逝去的Atlantis文明" class="headerlink" title="探寻逝去的Atlantis文明"></a>探寻逝去的Atlantis文明</h1><p>该题很险，差一点丢分，本来想着早点儿起来做的，没想到睡过了。。。。。<br>exe文件，win32平台，打开一看，有tls的反调试，直接去掉即可。<br>很及时的找到了关键点，本来以为g了，哈哈<br>题目利用GlobalAddAtom()函数和GlobalGetAtom()函数来传递字符串，一开始一直绕进01xxxxxx段里面去了， 跟踪堆栈，找到ReadFile读取控制台，然后。。。很晕，还好我机智的跳了出来，定位到了关键点：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">_DWORD *__<span class="function">cdecl <span class="title">sub_28F0104</span><span class="params">(_DWORD *a1, <span class="keyword">int</span> a2, <span class="keyword">int</span> a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// ST14_4</span></span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// ST04_4</span></span><br><span class="line">  _DWORD *result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// [esp+0h] [ebp-18h]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [esp+8h] [ebp-10h]</span></span><br><span class="line">  <span class="keyword">int</span> v8; <span class="comment">// [esp+Ch] [ebp-Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// [esp+10h] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  v8 = *a1;</span><br><span class="line">  v9 = a1[<span class="number">1</span>];</span><br><span class="line">  v6 = (<span class="keyword">int</span>)(a1 + <span class="number">2</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; a3; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v8 = (<span class="keyword">unsigned</span> __int8)(v8 + <span class="number">1</span>);</span><br><span class="line">    v3 = *(_DWORD *)(v6 + <span class="number">4</span> * v8);</span><br><span class="line">    v9 = (<span class="keyword">unsigned</span> __int8)(v3 + v9);</span><br><span class="line">    v4 = *(_DWORD *)(v6 + <span class="number">4</span> * v9);</span><br><span class="line">    *(_DWORD *)(v6 + <span class="number">4</span> * v8) = v4;</span><br><span class="line">    *(_DWORD *)(v6 + <span class="number">4</span> * v9) = v3;</span><br><span class="line">    *(_BYTE *)(i + a2) ^= *(_BYTE *)(v6 + <span class="number">4</span> * (<span class="keyword">unsigned</span> __int8)(v4 + v3));</span><br><span class="line">  &#125;</span><br><span class="line">  *a1 = v8;</span><br><span class="line">  result = a1;</span><br><span class="line">  a1[<span class="number">1</span>] = v9;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>a2是输入的字符，经过base64编码，（原来里面搞来搞去就是为了这个），然后异或一个数字，得出结果后跟下面的数字比较:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span> __<span class="function">cdecl <span class="title">sub_28F04A7</span><span class="params">(<span class="keyword">const</span> <span class="keyword">void</span> *a1, <span class="keyword">int</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  v3 = <span class="number">-54</span>;</span><br><span class="line">  v4 = <span class="number">-101</span>;</span><br><span class="line">  v5 = <span class="number">-12</span>;</span><br><span class="line">  v6 = <span class="number">101</span>;</span><br><span class="line">  v7 = <span class="number">-60</span>;</span><br><span class="line">  v8 = <span class="number">-49</span>;</span><br><span class="line">  v9 = <span class="number">112</span>;</span><br><span class="line">  v10 = <span class="number">12</span>;</span><br><span class="line">  v11 = <span class="number">74</span>;</span><br><span class="line">  v12 = <span class="number">91</span>;</span><br><span class="line">  v13 = <span class="number">-69</span>;</span><br><span class="line">  v14 = <span class="number">91</span>;</span><br><span class="line">  v15 = <span class="number">40</span>;</span><br><span class="line">  v16 = <span class="number">43</span>;</span><br><span class="line">  v17 = <span class="number">7</span>;</span><br><span class="line">  v18 = <span class="number">-24</span>;</span><br><span class="line">  v19 = <span class="number">-50</span>;</span><br><span class="line">  v20 = <span class="number">-102</span>;</span><br><span class="line">  v21 = <span class="number">0</span>;</span><br><span class="line">  v22 = <span class="number">77</span>;</span><br><span class="line">  v23 = <span class="number">103</span>;</span><br><span class="line">  v24 = <span class="number">-94</span>;</span><br><span class="line">  v25 = <span class="number">-65</span>;</span><br><span class="line">  v26 = <span class="number">19</span>;</span><br><span class="line">  <span class="keyword">return</span> a2 == <span class="number">24</span> &amp;&amp; !<span class="built_in">memcmp</span>(a1, &amp;v3, <span class="number">0x18</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>动态调试获取 <em>(_BYTE </em>)(v6 + 4 * (unsigned __int8)(v4 + v3));中的异或的数字，然后很舒服：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">str = [<span class="number">0x98</span>,<span class="number">0xde</span>,<span class="number">0xa6</span>,<span class="number">0x21</span>,<span class="number">0x92</span>,<span class="number">0x8a</span>,<span class="number">0x2a</span>,<span class="number">0x3b</span>,<span class="number">0x2f</span>,<span class="number">0x13</span>,<span class="number">0xd7</span>,<span class="number">0x6d</span>,<span class="number">0x61</span>,<span class="number">0x51</span>,<span class="number">0x4a</span>,<span class="number">0x82</span>,<span class="number">0x94</span>,<span class="number">0xdd</span>,<span class="number">0x39</span>,<span class="number">0x23</span>,<span class="number">0x3f</span>,<span class="number">0x91</span>,<span class="number">0x8f</span>,<span class="number">0x2e</span>]</span><br><span class="line">str2 =[ <span class="number">0xCA</span>,<span class="number">0x9B</span>, <span class="number">0xF4</span> ,<span class="number">0x65</span>,<span class="number">0xC4</span>,<span class="number">0xCF</span>,<span class="number">0x70</span>,<span class="number">0xC</span>,<span class="number">0x4A</span>,<span class="number">0x5B</span>,<span class="number">0xBB</span>,<span class="number">91</span>,<span class="number">0x28</span>,<span class="number">0x2B</span>,<span class="number">7</span>,<span class="number">0xE8</span>,<span class="number">0xCE</span>,<span class="number">0x9A</span>,<span class="number">0</span>,<span class="number">0x4D</span>,<span class="number">0x67</span>,<span class="number">0xA2</span>,<span class="number">0xBF</span>,<span class="number">0x13</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(str2)):</span><br><span class="line">    <span class="keyword">print</span> chr(str2[i]^str[i]),</span><br></pre></td></tr></table></figure></p>
<p>得出结果RERDVEZ7eHl6IzMjZG9nX30= 即</p>
<blockquote>
<p>DDCTF{xyz#3#dog_}</p>
</blockquote>
<p>回头一看，还有7分钟，- -</p>
<p>唯一很遗憾的是不能去交流会，瞻仰各位大佬，哎，web一点不会，菜到不行</p>


      

    </section>
    
      <section class='ArticleMeta'>
          <div>
            发布于&nbsp;
            <time datetime="2018-04-20T06:32:29.000Z" itemprop="datePublished">
              2018-04-20
            </time>
          </div>
          
      </section>
    
    
</article>

  
</div>

            <footer>
    <div>© 2016 - foyjog </div>
    <div>
    Powered by Hexo
    </div>
</footer>

        </div>
    </div>
</div>
<script src="/js/pager/dist/singlepager.js"></script>
<script>
var sp = new Pager('data-pager-shell')

</script>
</body>
</html>